name: deploy
on:
  workflow_run:
    workflows: [build]
    types: [completed]
    branches: [main,continuous-delivery]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:    
      - uses: actions/download-artifact@v3
        with:
          name: Artifacts
          path: distfiles
      - name: copy file to server
        uses: appleboy/scp-action@v0.1.4
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.KEY }}
          port: ${{ secrets.PORT }}
          source: distfiles/*,server-scripts/*
          target: /tmp/minecraft
      - name: publish build artifacts
        uses: Kir-Antipov/mc-publish@v3.3
        with:
            github-token: ${{ secrets.GITHUB_TOKEN }}
            files: distfiles/*.jar